# 第8章 进程控制
## 进程标识
每个进程有一个非负整型表示的唯一进程ID，下列函数返回进程ID和其他标识符
```
#include <unistd.h>
pid_t getpid(void);       // 调用进程ID
pid_t getppid(void);      // 调用进程的父进程ID
uid_t getuid(void);       // 调用进程的实际用户ID
uid_t geteuid(void);      // 调用进程的有效用户ID
gid_t getgid(void);       // 调用进程的实际组ID
gid_t getegid(void);      // 调用进程的有效组ID
```
## 子进程
进程可以调用fork函数创建一个子进程
```
#include <unistd.h>
pid_t fork(void);
// 子进程返回0，父进程返回子进程ID
```
### 数据空间
> 子进程是父进程的一个副本，共享正文段，但不共享数据空间、堆和栈  
> 子进程中变量的改变不影响父进程的变量的值
### 文件共享
> 父进程所有的文件描述符都被复制到子进程中  
> 相同的文件描述符指向同一个文件表项  
> 父子进程共享同一个文件偏移量
>
![文件共享](img/share_file.png)
### 父子进程差异
* fork()的返回值不同
* 进程ID不同
* 父进程ID不同
* 子进程的tms_utime、tms_stime、tms_cutime和tms_ustime设置为0
* 子进程不继承父进程的文件锁
* 子进程的未处理闹钟被清除
* 子进程的未处理信号机设置为空集
### 退出状态
父进程通过wait获取子进程状态  
* 如果所有子进程还在运行，则阻塞
* 如果一个子进程已经终止，则取得终止状态立即返回
* 如果没有任何子进程，则立即出错返回
```
#include <sys/wait.h>
// 函数返回终止进程的pid，并将终止状态存放在statloc中
// 终止状态用4个宏来查看
pid_t wait(int *statloc);
pid_t waitpid(pid_t pid, int *statloc, int options);

// waitid用两个单独的参数表示要等待的子进程所属的类型
int waitid(idtype_t idtype, id_t id, siginfo_t *infop, int options);
// 另外还有wait3, wait4，提供的功能更多
```
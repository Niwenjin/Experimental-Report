# Effective STL

## 目录

[容器](#容器)  
[vector和string](#vector和string)  
[关联容器](#关联容器)  
[迭代器](#迭代器)  
[算法](#算法)  
[仿函数、仿函数类、函数等](#仿函数仿函数类函数等)  
[使用STL编程](#使用stl编程)

## 容器

### 条款01：慎重选择容器类型

C++ 提供了几种不同的容器供你选择：

* 标准STL序列容器：vector、string、deque、list
* 标准STL关联容器 ：set、multiset、map、multimap
* 非标准序列容器：slist、rope
* 非标准关联容器：hash_set、hash_multiset、hash_map、hash_multimap

### 条款02：不要试图编写独立于容器类型的代码

STL是以泛化（generalization）原则为基础的：数组被泛化为“以其包含的对象的类型为参数”的**容器**；函数被泛化为“以其使用的迭代器的类型为参数”的**算法**；指针被泛化为“以其指向的对象的类型为参数”的**迭代器**。

容器类型被泛化为序列和关联容器，类似的容器被赋予相似的功能。不同的容器是不同的，它们并不是被设计来交换使用的，试图编写对序列容器和关联容器都适用的代码几乎是毫无意义的。

### 条款03：确保容器中的对象副本正确而高效

复制对象是STL的工作方式：进去的是副本，出来的也是副本（copy in, copy out），移动元素也是复制。对象的拷贝构造函数可能会消耗大量时间。通常，用容器保存**指针**比保存对象更好，保存**智能指针**比原生指针好。

### 条款04：调用empty而不是检查size()是否为0

empty对所有的标准容器都是常数时间操作，而对一些list实现，size耗费线性时间。

### 条款05：区间成员函数优先于与之对应的单元素成员函数

给容器赋值、插入或删除时应该使用assign、insert和erase这些区间成员函数，而不是循环操纵单元素。

### 条款06：当心C++编译器最烦人的分析机制

### 条款07：如果容器中包含了通过new操作创建的指针，切记在容器对象析构前将指针delete掉

*注意：更好的做法是使用智能指针。*

### ~~条款08：切勿创建包含auto_ptr的容器对象~~

### 条款09：慎重选择删除元素的方法

对于不同的类型容器，有不同的删除方法。

循环删除容器中的元素时需要注意：调用`erase(it)`后，迭代器it会失效，无法获取下一个元素。

对于关联容器，删除，插入操作会导致指向该元素的迭代器失效，其他元素迭代器不受影响。最简单的办法是，当调用时对it使用后缀递增。

```cpp
for(auto it = v.begin(); it != v.end(); ){
    v.erase(it++);
}
```

对于顺序容器，删除、插入操作会导致指向该元素以及后面的元素的迭代器失效。需要利用erase的返回值获取下一个元素的迭代器。

```cpp
for(auto it = v.begin(); it != v.end(); ){
    it = v.erase(it);
    // erase()返回指向下一个有效元素的迭代器
}
```

### 条款10：了解分配器（allocator）的约定和限制

### 条款11：理解自定义分配器的合理用法

### 条款12：切勿对STL容器的线程安全性有不切实际的依赖

## vector和string

### 条款13：用vector和string替代动态分配的数组

### 条款14：使用reserve来避免不必要的重新分配

当STL容器需要更多的空间时，操作如下：

1. 分配一块大小为当前容量的某个倍数的新内存（通常为2倍）；
2. 把容器的所有元素从旧的内存复制到新的内存中；
3. 析构掉旧内存中的对象；
4. 释放旧内存。

为了避免这些非常耗时的步骤，需要使用reserve()。

### 条款15：注意string实现的多样性

### 条款16：了解如何把vector和string数据传给旧API

### 条款17：使用“swap技巧”除去多余的容量

利用利用匿名容器会自动析构这个特点，可以压缩vector占用的内存：

```cpp
vector<int> v;
// 容器操作
vector<int>(v).swap(v);
// 利用匿名容器拷贝v的内容，再和v进行交换
```

### 条款18：避免使用`vector<bool>`

`vector<bool>`不完全满足STL容器的要求，可以用`deque<bool>`和bitset来替代它。

## 关联容器

## 迭代器

## 算法

## 仿函数、仿函数类、函数等

## 使用STL编程
